sheet = 6,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_UK <- PMI_UK[c(6:257),]
PMI_USA <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 7,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_USA <- PMI_USA[c(6:257),]
PMI_Chi <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 8,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Chi <- PMI_Chi[c(6:257),]
PMI_Ind <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 9,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Ind <- PMI_Ind[c(6:257),]
PMI_Bra <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 10,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Bra <- PMI_Bra[c(6:257),]
PMI_Jap <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 11,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Jap <- PMI_Jap[c(6:257),]
PMI_Rus <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 12,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Rus <- PMI_Rus[c(6:257),]
PMI_Pol <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 13,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Pol <- PMI_Pol[c(6:257),]
PMI_Mex <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 14,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Mex <- PMI_Mex[c(6:257),]
PMI_Can <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 15,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Can <- PMI_Can[c(6:257),]
PMI_Tur <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 16,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Tur <- PMI_Tur[c(6:257),]
PMI_Hol <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 17,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Hol <- PMI_Hol[c(6:257),]
PMI_Aus <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 18,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Aus <- PMI_Aus[c(6:257),]
PMI_Indo <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 19,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Indo <- PMI_Indo[c(6:257),]
PMI_NZ <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 20,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_NZ <- PMI_NZ[c(6:257),]
PMI_Egy <- read_excel("C:/Users/paulf/Downloads/Test Git/Data PMI_memoire.xlsx",
sheet = 21,
col_names = c("Date","Composite", "Synthetique industrie",
"Production passee", "Emploi_industrie",
"Nouvelles commandes", "Stocks",
"Delais de livraison", "Commandes export",
"Prix output industrie", "Prix input industrie",
"Synthetique services = activites",
"Nouvelles affaires", "Emploi_services",
"Backlogs of work","Activite future",
"Prix output services", "Prix input services"),
col_types = c("date","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric","numeric","numeric",
"numeric","numeric","numeric")
)
PMI_Egy <- PMI_Egy[c(6:257),]
#############################################################
#Fusion de toutes ces df
Periodes <- rep(1:252, 21)
Pays_nom <- c(rep("Euro", 252), rep("Fra", 252), rep("All", 252), rep("Ita", 252)
, rep("Esp", 252), rep("UK", 252), rep("USA", 252), rep("Chi", 252)
, rep("Ind", 252), rep("Bra", 252), rep("Jap", 252), rep("Rus", 252)
, rep("Pol", 252), rep("Mex", 252), rep("Can", 252), rep("Tur", 252)
, rep("Hol", 252), rep("Aus", 252), rep("Indo", 252), rep("NZ", 252)
, rep("Egy", 252))
Pays_num <- c(rep(1:21, each = 252))
PMI <- rbind(PMI_euro,PMI_Fra,PMI_All,PMI_Ita,PMI_Esp,PMI_UK,PMI_USA,PMI_Chi
,PMI_Ind,PMI_Bra,PMI_Jap,PMI_Rus,PMI_Pol,PMI_Mex,PMI_Can,PMI_Tur
,PMI_Hol,PMI_Aus,PMI_Indo,PMI_NZ,PMI_Egy)
PMI <- cbind(Periodes, PMI)
PMI <- cbind(Pays_nom, PMI)
PMI <- cbind(Pays_num, PMI)
#############################################################
#Supprimer les bases qui seront inutiles
rm(PMI_euro)
rm(PMI_Fra)
rm(PMI_All)
rm(PMI_Ita)
rm(PMI_Esp)
rm(PMI_UK)
rm(PMI_USA)
rm(PMI_Chi)
rm(PMI_Ind)
rm(PMI_Bra)
rm(PMI_Jap)
rm(PMI_Rus)
rm(PMI_Pol)
rm(PMI_Mex)
rm(PMI_Can)
rm(PMI_Tur)
rm(PMI_Hol)
rm(PMI_Aus)
rm(PMI_Indo)
rm(PMI_NZ)
rm(PMI_Egy)
rm(Pays_nom)
rm(Pays_num)
rm(Periodes)
pays.synth <- PMI[c(pays_nom ="XXX"),]
View(pays.synth)
function(x,y,z){
toto= 3*x + 5*y +8*z
}
goku <- function(x,y,z){
toto= 3*x + 5*y +8*z
}
goku(4,7,6)
goku <- function(x,y,z){
toto= 3*x + 5*y +8*z
return(toto)
}
goku(4,7,6)
library(ggthemes)
library(ggplot2)
library(readr)
library(dplyr)
library(kableExtra)
library(stargazer)
library(readxl)
library(Synth)
library(base)
library(utilities)
################################################################################
#                                                                              #
# L'objectif de cette partie est de montrer comment maitriser la synthetisation#
# tout en pointant en CCL les aspects qui peuvent etre ameliores afin de       #
# rendre le code plus souple.                                                  #
#                                                                              #
################################################################################
#Ce code doit etre lance apres le code "PARTIE 0 - DATA.R"
source("PARTIE 0 - DATA.R")
############################################################
############################################################
############################################################
#PARTIE SYNTHETISATION#
############################################################
############################################################
############################################################
# PARTIE 0 #
#Initialisation du programme
#Entrer le nom du pays dont on veut synthetiser la serie
pays.synth <- PMI[c(pays_nom ="XXX"),]
#Entrer les noms des pays qui constitueront notre groupe donateur
#Le mieux serait de rentrer les pays que l'on veut voir apparaitre dans un
#vecteur puis automatiser l'attribution des noms pays.don
pays.don1
pays.don2
pays.don3
pays.don4
pays.don5
pays.don6
pays.don7
pays.don8
pays.don9
#Entrer l'intervalle de periodes sur lequel on determine les coeff de ponderation
#L'ideal serait d'avoir a rentrer les dates puis d'obtenir les periodes associees
#pour realiser la synhtetisation
#Entrer l'intervalle de periodes sur lequel on trace notre serie
#L'ideal serait d'avoir a rentrer les dates puis d'obtenir les periodes associees
#pour realiser la synhtetisation
# PARTIE 0bis #
#Il est possible de realiser des synthetisations differentes en changeant :
# - la variable predictive (predictors)
# - la methode de prediction utilisee (predictors.op)
# PARTIE 1 #
#La fonction dataprep() du package Synth permet de creer des sous-bases pour
#automatiser et faciliter la synthetisation
fra <- dataprep(foo = PMI,
predictors = "Composite" ,
predictors.op = "mean" ,
time.predictors.prior = 9:252,
dependent = "Composite",
unit.variable = "Pays_num",
unit.names.variable = "Pays_nom",
time.variable = "Periodes",
treatment.identifier = 2,
controls.identifier = c(3:5),
time.optimize.ssr = 50:252,
time.plot = 9:252
)
#Axes d'ameliorations :
#(i) faire tourner avec d'autres variables predictors, pour constater la potentielle
#amelioration de l'estimation (Hyp: elle sera forcemment plus precise car elle est
#au moins aussi precise que l'estimation qui considere seulement la variable composite)
#(ii) completer la df pour faire tourner avec plus de pays donateurs sur des
#periodes plus grandes
# PARTIE 2 #
#Creation du vecteur de ponderations de la contribution des pays donateurs
#"Solution w"
#Creation du vecteur de ponderations de la contribution des variables Predictors
#"Solution v" (=1 car seulement "Composite")
list.synth.fra <- synth(data.prep.obj = fra,
method = "BFGS")
#Pi : Il est possible d'utiliser plusieurs algos d'optimisation c("Nelder-Mead', 'BFGS', 'CG', 'L-BFGS-B', 'nlm', 'nlminb', 'spg', and 'ucminf")
#Le BFGS est le quasi-Newton algorithm
#Axes d'amelioration :
#(i) Verifier le fonctionnement des differents algos, les tester si cela parait pertinent
serie.synth.fra <- fra$Y0plot %*% list.synth.fra$solution.w
gaps.list.synth.fra <- fra$Y1plot - serie.synth.fra
# PARTIE 3 #
#Tracer les graphiques pour visualiser les ecarts entre les series reelles
# et les series synthetiques
#Avec fonction du package(Synth)
#Ecart
gaps.plot(synth.res = list.synth.fra,
dataprep.res = fra,
Ylab = c("Ecart"),
Xlab = c("Periodes"),
Main = c("Ecart : Traite - Synthetique"))
#Avec fonction ggplot
#Ecart
date.plot <- PMI$Date[c(9:252)]
gaps.list.synth.fra <- gaps.list.synth.fra
ecart.fra.plot <- data.frame(date.plot, as.numeric(gaps.list.synth.fra))
colnames(ecart.fra.plot) <- c("Dates", "Ecarts")
ggplot(ecart.fra.plot, aes(Dates)) +
geom_line(aes(y = Ecarts)) +
geom_hline(yintercept=(0),linetype="dotted")+
xlab("Dates")+
ylab("Ecarts")
theme_classic()
#Tracer la serie reelle et la serie synth
date.plot <- PMI$Date[c(9:252)]
serie.reelle.fra <- fra$Y1plot
serie.synth.fra <- serie.synth.fra
fra.plot <- data.frame(date.plot, as.numeric(serie.reelle.fra), as.numeric(serie.synth.fra))
colnames(fra.plot) <- c("Dates", "Synth", "Reelle")
ggplot(fra.plot, aes(Dates)) +
geom_line(aes(y = Synth), color = "blue") +
geom_line(aes(y = Reelle), color = "red") +
geom_hline(yintercept=(50),linetype="dotted")+
xlab("Dates")+
ylab("Composite")
theme_classic()
#Axe d'amelioration : Lorsque je nomme les colonnes par seulement une lettre,
#j'obtiens un graph sur fond blanc (plus clean pour exporter)
#Axe d'amelioration : Une fois que le code est termine, changer le code en y
# integrant des variables generiques et expliquer en amont les donnees que
#l'on doit attribuer aux variables pour effectuer les differents tests
# PARTIE 4 #
#Calcul de l'erreur quadratique moyenne entre la serie reelle et la serie
#synthetisee
mse <- (gaps.list.synth.fra)^2
rmse<-0
for (i in 1:244) {rmse<-rmse+mse[i]}
rmse<-rmse/244
rmse<-sqrt(rmse)
View(rmse)
#L'erreur quadratique moyenne permet de comparer la precision de notre synthetisation
#Elle permet de comparer la surface entre entre la courbe de la serie synth
#et celle de la serie reelle
#Axe d'amelioration : Il serait interessant de trouver un lien entre le rmse
#lors de la creation de notre serie synthetique et le rmse de estimation du PIB
###########################################################
###########################################################
###########################################################
### CONCLUSION ###
###########################################################
###########################################################
###########################################################
#La partie ci dessus permet donc de synthetiser des series a partir d'un groupe donateur
#Afin d'ameliorer la structure du programme :
#  - Trouver un moyen de faciliter au maximum la realisation de differents
#tests en automatisant l'entree des inputs en amont
#(ex: pays test, groupe donateur, periode)
#  - Faire apparaitre facilement la ponderation des differents pays donateurs
#Afin d'ameliorer les reglages du programme :
#  - Tester en ajoutant des variables predictors
#  - Tester d'autres algo d'optimisation que le "BFGS"
#Ne pas oublier de supprimer tous les objets qui ne servent qu'a la construction
View(PMI)
auto <- function(timepp,traitement,
controlsid, timeoptssr,timeplot
){
# PARTIE 1 #
#La fonction dataprep() du package Synth permet de creer des sous-bases pour
#automatiser et faciliter la synthetisation
fra <- dataprep(foo = PMI,
predictors = "Composite" ,
predictors.op = "mean" ,
time.predictors.prior = timepp,
dependent = "Composite",
unit.variable = "Pays_num",
unit.names.variable = "Pays_nom",
time.variable = "Periodes",
treatment.identifier = traitement,
controls.identifier = controlsid,
time.optimize.ssr = timeoptssr,
time.plot = timeplot
)
return(fra)
}
auto(9:252, 2, c(3:5), 50:252, 9:252)
fratest <- auto(9:252, 2, c(3:5), 50:252, 9:252)
View(fratest)
View(fratest)
View(fra)
